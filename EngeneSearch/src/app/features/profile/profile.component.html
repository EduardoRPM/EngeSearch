<app-header></app-header>

<div class="p-6 space-y-6 pb-20">
  <div>
    <h1 class="text-2xl font-bold text-foreground">Perfil personal</h1>
    <p class="text-sm text-muted-foreground">Consulta tu informacion y actualiza tu contrasena.</p>
  </div>

  <div *ngIf="loadError" class="rounded-lg border border-red-200 bg-red-50 text-red-700 p-4 flex items-start gap-3">
    <svg class="w-5 h-5 mt-0.5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m0 3.75h.007v.008H12V16.5Zm9 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
    </svg>
    <div class="flex-1 text-sm">
      <p class="font-semibold">No se pudo cargar el perfil</p>
      <p>{{ loadError }}</p>
      <button type="button" class="mt-2 text-xs font-semibold underline" (click)="retryLoad()">Intentar de nuevo</button>
    </div>
  </div>

  <div *ngIf="isLoading" class="rounded-lg border border-border bg-card p-4 text-sm text-muted-foreground">
    Cargando informacion...
  </div>

  <ng-container *ngIf="!isLoading && profile as profileData">
    <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
      <section class="bg-card border border-border rounded-2xl p-6 info-card space-y-4">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-lg font-semibold text-foreground">Datos personales</h2>
            <p class="text-sm text-muted-foreground">Estos datos provienen de tu cuenta registrada.</p>
          </div>
          <span class="px-3 py-1 rounded-full text-xs font-semibold bg-[#E8E6FF] text-[#3D4676] uppercase">
            {{ profileData.role }}
          </span>
        </div>

        <dl class="space-y-3 text-sm">
          <div>
            <dt class="text-muted-foreground">Nombre completo</dt>
            <dd class="text-foreground font-medium">{{ profileData.name }}</dd>
          </div>
          <div>
            <dt class="text-muted-foreground">Correo electronico</dt>
            <dd class="text-foreground font-medium">{{ profileData.email }}</dd>
          </div>
          <div>
            <dt class="text-muted-foreground">Rol asignado</dt>
            <dd class="text-foreground font-medium">
              {{ profileData.role === 'admin' ? 'Administrador' : 'Usuario' }}
            </dd>
          </div>
        </dl>
      </section>
    </div>

    <section class="bg-card border border-border rounded-2xl p-6 info-card space-y-4">
      <div class="flex items-start justify-between gap-3">
        <div>
          <h2 class="text-lg font-semibold text-foreground">Actualizar contrasena</h2>
          <p class="text-sm text-muted-foreground">Cambia tu contrasena de acceso.</p>
        </div>
        <button
          type="button"
          class="px-3 py-1 text-sm font-semibold rounded-lg border border-border hover:bg-muted transition-colors flex items-center gap-2"
          (click)="togglePasswordForm()"
        >
          {{ showPasswordForm ? 'Cerrar' : 'Editar' }}
          <svg
            class="w-4 h-4 transition-transform"
            [class.rotate-180]="showPasswordForm"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            viewBox="0 0 24 24"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
          </svg>
        </button>
      </div>

      <div *ngIf="showPasswordForm" class="space-y-4">
        <div *ngIf="passwordError" class="rounded-lg border border-red-200 bg-red-50 text-red-700 p-3 text-sm">
          {{ passwordError }}
        </div>
        <div *ngIf="passwordMessage" class="rounded-lg border border-green-200 bg-green-50 text-green-700 p-3 text-sm">
          {{ passwordMessage }}
        </div>

        <div class="grid gap-4 md:grid-cols-2">
          <label class="text-sm font-medium text-foreground space-y-2">
            Nueva contrasena
            <input
              [(ngModel)]="passwordForm.newPassword"
              type="password"
              class="w-full border border-border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#384CBF]"
              placeholder="Nueva contrasena"
            />
          </label>
          <label class="text-sm font-medium text-foreground space-y-2">
            Confirmar contrasena
            <input
              [(ngModel)]="passwordForm.confirmPassword"
              type="password"
              class="w-full border border-border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#384CBF]"
              placeholder="Confirmar contrasena"
            />
          </label>
        </div>

        <div class="flex justify-end">
          <button
            type="button"
            class="px-4 py-2 bg-[#384CBF] text-white rounded-lg hover:bg-[#384CBF]/90 transition-colors text-sm disabled:opacity-60"
            (click)="savePassword()"
            [disabled]="isUpdatingPassword"
          >
            {{ isUpdatingPassword ? 'Guardando...' : 'Guardar nueva contrasena' }}
          </button>
        </div>
      </div>
    </section>
  </ng-container>
</div>
